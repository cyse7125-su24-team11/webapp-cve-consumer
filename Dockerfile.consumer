# Use the official Golang image as a builder stage
FROM golang:1.22.3 AS builder
 
# Set the working directory inside the container
WORKDIR /opt/app
 
# Copy the Go module files
COPY ./webapp/go.mod .
COPY ./webapp/go.sum .
 
# Download Go dependencies
RUN go mod download
 
# Copy the main.go file into the container
COPY ./webapp/main.go .
 
# Build the Go application
RUN go build -o webapp-consumer main.go
 
# Start a new stage from scratch
FROM golang:1.22.3
 
# Set the working directory inside the container
WORKDIR /opt/app
 
# Copy the compiled binary from the builder stage
COPY --from=builder /opt/app/webapp-consumer .
 
RUN apt update -y
RUN apt install -y wget default-jdk postgresql-client telnet

RUN wget https://archive.apache.org/dist/kafka/3.0.0/kafka_2.13-3.0.0.tgz
RUN tar -xzf kafka_2.13-3.0.0.tgz


# Run the executable
CMD ["./webapp-consumer"]